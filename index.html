<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ENIGMA Tool</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #121212;
      color: #fff;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    .light-mode {
      background: #f5f5f5;
      color: #000;
    }
    .panel {
      margin: 20px auto;
      padding: 20px;
      width: 95%;
      max-width: 400px;
      border-radius: 20px;
      background: #1e1e1e;
    }
    .light-mode .panel {
      background: #fff;
      color: #000;
    }
    .row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    input {
      width: 120px;
      padding: 8px;
      border-radius: 10px;
      border: none;
      text-align: center;
    }
    button {
      padding: 8px 14px;
      margin-left: 5px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }
    .btn-win { background: #2ecc71; color: white; }
    .btn-loss { background: #e74c3c; color: white; }
    .btn-undo { background: #3498db; color: white; }
    .btn-mode { background: none; border: none; font-size: 20px; cursor: pointer; }
    .bubble-container {
      margin-top: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
    }
    .bubble {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: gray;
    }
    .bubble.win { background: green; }
    .bubble.loss { background: red; }
    .popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 20px;
      border-radius: 15px;
      background: #222;
      color: white;
      display: none;
      z-index: 10;
      width: 80%;
      max-width: 300px;
    }
    .light-mode .popup {
      background: #fff;
      color: #000;
    }
  </style>
</head>
<body>
  <button class="btn-mode" id="modeToggle">üåô</button>
  <div class="panel">
    <div class="row">
      <label>Initial Balance</label>
      <input type="number" id="initialBalance" value="10000">
    </div>
    <div class="row">
      <label>Current Balance</label>
      <input type="number" id="currentBalance" value="10000">
      <input type="number" id="adjustAmount" placeholder="Amount">
      <button onclick="adjustBalance('+')">+</button>
      <button onclick="adjustBalance('-')">-</button>
    </div>
    <div class="row">
      <label>Risk %</label>
      <input type="number" id="riskPercent" value="1">
    </div>
    <div class="row">
      <label>Total Account Drawdown</label>
      <input type="number" id="drawdown" value="0">
    </div>
    <div class="row">
      <button class="btn-win" onclick="addBubble('win')">WIN</button>
      <button class="btn-loss" onclick="addBubble('loss')">SL</button>
      <button class="btn-undo" onclick="undoBubble()">UNDO</button>
    </div>
    <div class="row">
      <p>Winrate: <span id="winrate">0%</span> | Streak: <span id="streak">0</span></p>
    </div>
    <div class="bubble-container" id="bubbles"></div>
  </div>

  <div class="popup" id="popup"></div>

  <script>
    const bubblesEl = document.getElementById("bubbles");
    const winrateEl = document.getElementById("winrate");
    const streakEl = document.getElementById("streak");
    const popupEl = document.getElementById("popup");
    const currentBalanceEl = document.getElementById("currentBalance");
    const adjustAmountEl = document.getElementById("adjustAmount");
    const modeToggle = document.getElementById("modeToggle");

    let bubbles = JSON.parse(localStorage.getItem("bubbles")) || [];
    let streak = parseInt(localStorage.getItem("streak")) || 0;
    let wins = parseInt(localStorage.getItem("wins")) || 0;
    let losses = parseInt(localStorage.getItem("losses")) || 0;

    const winQuotes = [
      "Stay disciplined, probability is on your side.",
      "Every win is just variance playing out.",
      "Process over outcome, always.",
      "Compounding is the real edge."
    ];
    const lossQuotes = [
      "Losses are tuition fees of the market.",
      "Protecting capital = surviving longer.",
      "One trade means nothing, the series means everything.",
      "Stay calm, probability needs losses to work."
    ];

    function saveData() {
      localStorage.setItem("bubbles", JSON.stringify(bubbles));
      localStorage.setItem("streak", streak);
      localStorage.setItem("wins", wins);
      localStorage.setItem("losses", losses);
      localStorage.setItem("currentBalance", currentBalanceEl.value);
    }

    function render() {
      bubblesEl.innerHTML = "";
      bubbles.forEach(b => {
        const div = document.createElement("div");
        div.className = "bubble " + b;
        bubblesEl.appendChild(div);
      });
      const total = wins + losses;
      const wr = total ? Math.round((wins / total) * 100) : 0;
      winrateEl.textContent = wr + "%";
      streakEl.textContent = streak;
    }

    function addBubble(type) {
      bubbles.push(type);
      if (type === "win") {
        wins++;
        streak = streak >= 0 ? streak + 1 : 1;
        showPopup(winQuotes[Math.floor(Math.random() * winQuotes.length)]);
      } else {
        losses++;
        streak = streak <= 0 ? streak - 1 : -1;
        showPopup(lossQuotes[Math.floor(Math.random() * lossQuotes.length)]);
      }
      saveData();
      render();
    }

    function undoBubble() {
      const last = bubbles.pop();
      if (!last) return;
      if (last === "win") {
        wins--;
        if (streak > 0) streak--;
        else streak = 0;
      } else {
        losses--;
        if (streak < 0) streak++;
        else streak = 0;
      }
      saveData();
      render();
    }

    function showPopup(msg) {
      popupEl.textContent = msg;
      popupEl.style.display = "block";
      setTimeout(() => popupEl.style.display = "none", 2000);
    }

    function adjustBalance(op) {
      let amt = parseFloat(adjustAmountEl.value);
      if (isNaN(amt)) return;
      let current = parseFloat(currentBalanceEl.value);
      if (op === '+') current += amt;
      else current -= amt;
      currentBalanceEl.value = current;
      saveData();
    }

    modeToggle.addEventListener("click", () => {
      document.body.classList.toggle("light-mode");
      modeToggle.textContent = document.body.classList.contains("light-mode") ? "‚òÄÔ∏è" : "üåô";
    });

    // Restore
    currentBalanceEl.value = localStorage.getItem("currentBalance") || currentBalanceEl.value;
    render();
  </script>
</body>
</html>
