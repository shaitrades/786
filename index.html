<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ENIGMA Risk Tool</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    .container {
      background: #222;
      padding: 20px;
      border-radius: 15px;
      width: 320px;
      text-align: center;
    }
    .row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 8px 0;
    }
    input, button, select {
      padding: 6px;
      border-radius: 6px;
      border: none;
    }
    input.small {
      width: 70px;
    }
    .buttons button {
      flex: 1;
      margin: 2px;
      padding: 10px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
    }
    .buttons {
      display: flex;
      margin-top: 10px;
    }
    .quote {
      margin-top: 10px;
      font-style: italic;
      color: #ccc;
    }
    .switch {
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="row">
      <label>IB:</label>
      <input type="number" id="ib" value="10000" class="small">
    </div>
    <div class="row">
      <label>CB:</label>
      <input type="number" id="cb" value="10000" class="small">
      <input type="number" id="cbChange" value="0" class="small">
      <button onclick="adjustCB(true)">+</button>
      <button onclick="adjustCB(false)">-</button>
    </div>
    <div class="row">
      <label>TAD:</label>
      <input type="number" id="tad" value="1000" class="small">
    </div>
    <div class="row">
      <label>Risk%:</label>
      <input type="number" id="risk" value="2" class="small">
    </div>

    <div class="row">
      <strong>Winrate:</strong> <span id="winrate">0%</span>
    </div>
    <div class="row">
      <strong>Next Risk:</strong> <span id="nextrisk">0</span>
    </div>

    <div class="buttons">
      <button onclick="trade(true)">Win</button>
      <button onclick="trade(false)">Lose</button>
      <button onclick="undo()">Undo</button>
    </div>

    <div class="switch">
      <label>
        <input type="checkbox" id="riskMode" onchange="updateDisplay()"> Fixed Risk Mode
      </label>
    </div>

    <div class="quote" id="quote"></div>
  </div>

  <script>
    let history = [];
    let wins = 0, losses = 0;

    const quotes = [
      "Loss is just data, not identity.",
      "Protect the downside, the upside takes care of itself.",
      "Trading is probability, not certainty.",
      "One trade doesnâ€™t define you.",
      "Small edges, repeated, make fortunes."
    ];

    function adjustCB(add) {
      let cb = parseFloat(document.getElementById("cb").value);
      let change = parseFloat(document.getElementById("cbChange").value);
      if (isNaN(change) || change <= 0) return;
      document.getElementById("cb").value = add ? cb + change : cb - change;
      updateDisplay();
    }

    function trade(win) {
      history.push(win);
      if (win) wins++; else losses++;
      if (!win) showQuote();
      updateDisplay();
    }

    function undo() {
      if (history.length === 0) return;
      let last = history.pop();
      if (last) wins--; else losses--;
      updateDisplay();
    }

    function showQuote() {
      let q = quotes[Math.floor(Math.random() * quotes.length)];
      document.getElementById("quote").textContent = q;
    }

    function updateDisplay() {
      let ib = parseFloat(document.getElementById("ib").value);
      let cb = parseFloat(document.getElementById("cb").value);
      let tad = parseFloat(document.getElementById("tad").value);
      let riskPercent = parseFloat(document.getElementById("risk").value);
      let fixedMode = document.getElementById("riskMode").checked;

      // Winrate
      let total = wins + losses;
      let winrate = total > 0 ? ((wins / total) * 100).toFixed(1) : 0;
      document.getElementById("winrate").textContent = winrate + "%";

      // Next Risk Calculation
      let nextRisk;
      if (fixedMode && cb > ib) {
        nextRisk = (cb * riskPercent / 100).toFixed(2);
      } else {
        let remainingDD = tad - Math.max(0, ib - cb);
        nextRisk = (remainingDD * riskPercent / 100).toFixed(2);
      }
      document.getElementById("nextrisk").textContent = nextRisk;
    }

    updateDisplay();
  </script>
</body>
</html>
