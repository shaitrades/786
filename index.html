<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ENIGMA Tool</title>
  <style>
    :root {
      --bg-color: #f4f4f4;
      --text-color: #222;
      --panel-bg: #fff;
      --button-bg: #ddd;
      --button-text: #000;
      --bubble-green: #4caf50;
      --bubble-red: #f44336;
    }
    [data-theme="dark"] {
      --bg-color: #121212;
      --text-color: #eee;
      --panel-bg: #1e1e1e;
      --button-bg: #333;
      --button-text: #fff;
      --bubble-green: #66bb6a;
      --bubble-red: #ef5350;
    }
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    .panel {
      background: var(--panel-bg);
      padding: 15px;
      border-radius: 12px;
      margin-top: 20px;
      width: 95%;
      max-width: 400px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    h2 {
      text-align: center;
      margin: 0 0 15px 0;
    }
    .row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    label {
      flex: 1;
    }
    input {
      flex: 1;
      padding: 6px;
      border-radius: 6px;
      border: 1px solid #aaa;
      text-align: center;
    }
    .balance-control {
      display: flex;
      gap: 5px;
      margin-top: 5px;
    }
    .balance-control input {
      flex: 2;
    }
    button {
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      background: var(--button-bg);
      color: var(--button-text);
    }
    .actions {
      display: flex;
      justify-content: space-around;
      margin-top: 10px;
    }
    .bubbles {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 15px;
      justify-content: center;
    }
    .bubble {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 14px;
    }
    .bubble.green { background: var(--bubble-green); }
    .bubble.red { background: var(--bubble-red); }
    .stats {
      margin-top: 15px;
      text-align: center;
    }
    .dark-toggle {
      position: absolute;
      top: 12px;
      right: 12px;
      cursor: pointer;
      font-size: 22px;
    }
  </style>
</head>
<body>
  <div class="dark-toggle" id="themeToggle">üåô</div>
  <div class="panel">
    <h2>ENIGMA Tool</h2>

    <div class="row">
      <label for="ib">Initial Balance:</label>
      <input type="number" id="ib" placeholder="Enter IB">
    </div>

    <div class="row">
      <label for="cb">Current Balance:</label>
      <input type="number" id="cb" placeholder="Enter CB">
    </div>
    <div class="balance-control">
      <input type="number" id="balanceChange" placeholder="Enter amount">
      <button onclick="adjustBalance('+')">+</button>
      <button onclick="adjustBalance('-')">-</button>
    </div>

    <div class="row">
      <label for="tad">Target Amount of Drawdown:</label>
      <input type="number" id="tad" placeholder="Enter TAD">
    </div>

    <div class="row">
      <label for="risk">Risk %:</label>
      <input type="number" id="risk" placeholder="Enter %">
    </div>

    <div class="actions">
      <button onclick="addBubble(true)">Win</button>
      <button onclick="addBubble(false)">SL</button>
      <button onclick="undo()">Undo</button>
    </div>

    <div class="bubbles" id="bubbles"></div>
    <div class="stats">
      <p id="winrate">Winrate: 0%</p>
    </div>
  </div>

  <script>
    const bubblesEl = document.getElementById("bubbles");
    const winrateEl = document.getElementById("winrate");
    const themeToggle = document.getElementById("themeToggle");

    let bubbles = JSON.parse(localStorage.getItem("bubbles")) || [];
    let theme = localStorage.getItem("theme") || "light";

    document.body.setAttribute("data-theme", theme);
    themeToggle.textContent = theme === "dark" ? "‚òÄÔ∏è" : "üåô";

    function saveData() {
      localStorage.setItem("bubbles", JSON.stringify(bubbles));
      localStorage.setItem("ib", document.getElementById("ib").value);
      localStorage.setItem("cb", document.getElementById("cb").value);
      localStorage.setItem("tad", document.getElementById("tad").value);
      localStorage.setItem("risk", document.getElementById("risk").value);
    }

    function loadData() {
      document.getElementById("ib").value = localStorage.getItem("ib") || "";
      document.getElementById("cb").value = localStorage.getItem("cb") || "";
      document.getElementById("tad").value = localStorage.getItem("tad") || "";
      document.getElementById("risk").value = localStorage.getItem("risk") || "";
    }

    function renderBubbles() {
      bubblesEl.innerHTML = "";
      bubbles.forEach(b => {
        const div = document.createElement("div");
        div.className = `bubble ${b.win ? "green" : "red"}`;
        div.textContent = b.win ? "W" : "L";
        bubblesEl.appendChild(div);
      });
      updateStats();
      saveData();
    }

    function addBubble(win) {
      bubbles.push({ win });
      renderBubbles();
      showQuote(win);
    }

    function undo() {
      bubbles.pop();
      renderBubbles();
    }

    function updateStats() {
      if (bubbles.length === 0) {
        winrateEl.textContent = "Winrate: 0%";
        return;
      }
      let wins = bubbles.filter(b => b.win).length;
      let rate = ((wins / bubbles.length) * 100).toFixed(1);
      winrateEl.textContent = `Winrate: ${rate}%`;
    }

    function adjustBalance(type) {
      let cbInput = document.getElementById("cb");
      let change = parseFloat(document.getElementById("balanceChange").value);
      if (!isNaN(change)) {
        let cb = parseFloat(cbInput.value) || 0;
        cbInput.value = type === "+" ? cb + change : cb - change;
        saveData();
      }
    }

    function showQuote(win) {
      const winQuotes = [
        "Process over outcome. Trust it.",
        "One win doesn‚Äôt define you. Stay sharp.",
        "Consistency beats luck."
      ];
      const loseQuotes = [
        "Losses are tuition for mastery.",
        "Protect your mindset, not just your capital.",
        "Probability always plays out over time.",
        "Discipline today, freedom tomorrow."
      ];
      let quotes = win ? winQuotes : loseQuotes;
      alert(quotes[Math.floor(Math.random() * quotes.length)]);
    }

    themeToggle.addEventListener("click", () => {
      theme = theme === "dark" ? "light" : "dark";
      document.body.setAttribute("data-theme", theme);
      themeToggle.textContent = theme === "dark" ? "‚òÄÔ∏è" : "üåô";
      localStorage.setItem("theme", theme);
    });

    loadData();
    renderBubbles();
  </script>
</body>
</html>
