<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ENIGMAl</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #121212;
      color: white;
      transition: background 0.3s, color 0.3s;
    }
    .light {
      background: #f4f4f4;
      color: black;
    }
    .container {
      max-width: 420px;
      margin: auto;
    }
    .row {
      display: flex;
      justify-content: space-between;
      margin: 8px 0;
    }
    .row input {
      flex: 1;
      margin-left: 5px;
    }
    button {
      margin: 3px;
      padding: 8px 14px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      opacity: 0.85;
    }
    .win { background: #4caf50; color: white; }
    .loss { background: #f44336; color: white; }
    .undo { background: #555; color: white; }
    .mode-toggle {
      position: absolute;
      top: 10px;
      right: 10px;
      cursor: pointer;
      font-size: 22px;
    }
    select {
      width: 100%;
      padding: 8px;
      border-radius: 6px;
      border: none;
      margin-top: 5px;
    }
    .quote {
      margin: 10px 0;
      font-style: italic;
      color: #ccc;
    }
  </style>
</head>
<body>
  <div class="mode-toggle" id="modeToggle">üåô</div>
  <div class="container">
    <div class="row">
      <label>Initial Balance:</label>
      <input type="number" id="initialBalance" value="1000">
    </div>
    <div class="row">
      <label>Current Balance:</label>
      <input type="number" id="currentBalance" value="1000">
      <button onclick="adjustBalance(true)">+</button>
      <button onclick="adjustBalance(false)">-</button>
      <input type="number" id="adjustAmount" value="0" style="width:70px">
    </div>
    <div class="row">
      <label>Total DD %:</label>
      <input type="number" id="totalDD" value="10">
    </div>
    <div class="row">
      <label>Fixed Risk %:</label>
      <input type="number" id="fixedRisk" value="1">
    </div>
    <div class="row">
      <label>Risk Mode:</label>
      <select id="riskMode" onchange="updateDisplay()">
        <option value="dd">Total DD Mode</option>
        <option value="fixed">Fixed Risk Mode</option>
      </select>
    </div>

    <div class="row">
      <strong>Winrate:</strong> <span id="winrate">0%</span>
    </div>
    <div class="row">
      <strong>Next Risk:</strong> <span id="nextRisk">0</span>
    </div>

    <div class="row" style="justify-content:center;">
      <button class="win" onclick="recordResult(true)">Win</button>
      <button class="loss" onclick="recordResult(false)">Lose</button>
      <button class="undo" onclick="undo()">Undo</button>
    </div>

    <select id="eventsDropdown">
      <option disabled selected>Events</option>
    </select>

    <div class="quote" id="quoteBox"></div>
  </div>

  <script>
    let wins = 0, losses = 0;
    let history = [];
    const quotes = [
      "Losses are tuition you pay to the market.",
      "Focus on process, not outcome.",
      "Risk is the cost of opportunity.",
      "Every trade is just one of many.",
      "Probabilities matter more than certainty.",
      "Small losses protect you from big ones.",
      "Consistency beats intensity.",
      "Detach from results, trust your edge."
    ];

    function adjustBalance(add) {
      let amt = parseFloat(document.getElementById("adjustAmount").value) || 0;
      let cb = parseFloat(document.getElementById("currentBalance").value);
      document.getElementById("currentBalance").value = add ? cb + amt : cb - amt;
      updateDisplay();
    }

    function recordResult(isWin) {
      let cb = parseFloat(document.getElementById("currentBalance").value);
      let risk = parseFloat(document.getElementById("nextRisk").innerText);

      if (isWin) {
        cb += risk;
        wins++;
        addEvent("Win +" + risk.toFixed(2));
      } else {
        cb -= risk;
        losses++;
        addEvent("Loss -" + risk.toFixed(2));
        showQuote();
      }

      document.getElementById("currentBalance").value = cb;
      history.push({win:isWin, amount:risk});
      updateDisplay();
    }

    function undo() {
      if (history.length === 0) return;
      let last = history.pop();
      let cb = parseFloat(document.getElementById("currentBalance").value);

      if (last.win) { cb -= last.amount; wins--; }
      else { cb += last.amount; losses--; }

      document.getElementById("currentBalance").value = cb;
      updateDisplay();
    }

    function addEvent(text) {
      let dropdown = document.getElementById("eventsDropdown");
      let option = document.createElement("option");
      option.text = text;
      dropdown.add(option);
    }

    function showQuote() {
      document.getElementById("quoteBox").innerText =
        quotes[Math.floor(Math.random() * quotes.length)];
    }

    function updateDisplay() {
      let cb = parseFloat(document.getElementById("currentBalance").value);
      let ib = parseFloat(document.getElementById("initialBalance").value);
      let dd = parseFloat(document.getElementById("totalDD").value) / 100;
      let fr = parseFloat(document.getElementById("fixedRisk").value) / 100;
      let mode = document.getElementById("riskMode").value;

      let risk = 0;
      if (mode === "dd") {
        let maxLoss = ib * dd;
        let usedLoss = ib - cb;
        let remLoss = Math.max(maxLoss - usedLoss, 0);
        risk = remLoss * 0.1; // 10% of remaining DD
      } else {
        risk = cb * fr;
      }

      document.getElementById("nextRisk").innerText = risk.toFixed(2);
      let total = wins + losses;
      document.getElementById("winrate").innerText = total ? ((wins/total)*100).toFixed(1) + "%" : "0%";
    }

    // Light/Dark Mode
    document.getElementById("modeToggle").addEventListener("click", () => {
      document.body.classList.toggle("light");
      document.getElementById("modeToggle").innerText =
        document.body.classList.contains("light") ? "‚òÄÔ∏è" : "üåô";
    });

    updateDisplay();
  </script>
</body>
</html>
